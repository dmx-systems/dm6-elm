<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <script src="main.js">
  </script>
  <style>
    html {
      height: 100%;
    }
    body {
      height: 100%;
      margin: 0;
    }
    button.tool:hover:not(:disabled) {
      background-color: #d0d0d7 !important;
    }
    button.tool:active:not(:disabled) {
      background-color: #b1b1b9 !important;
    }
  </style>
</head>
<body>
<script>
const key = 'dm6-elm'
const modelStr = localStorage.getItem(key)
const model = modelStr ? JSON.parse(modelStr) : null
const app = Elm.Main.init({
  flags: model
})
app.ports.storeModel.subscribe(model => {
  localStorage.setItem(key, JSON.stringify(model))
})
app.ports.importJSON.subscribe(() => {
  const id = 'dm6-elm-importer'
  const input = document.getElementById(id) || document.createElement('input')
  if (!input.id) {
    input.id = id
    input.type = 'file'
    input.style.display = 'none'
    input.addEventListener('change', async () => {
      localStorage.setItem(key, await input.files[0].text())
      location.reload()
    })
    document.body.appendChild(input)
  }
  input.click()
})
app.ports.exportJSON.subscribe(() => {
  const id = 'dm6-elm-exporter'
  const modelStr = localStorage.getItem(key)
  const anchor = document.getElementById(id) || document.createElement('a')
  const file = new File([modelStr], 'not-used')
  const url = URL.createObjectURL(file)
  if (!anchor.id) {
    anchor.id = id
    anchor.download = 'dm6-elm-export.json'
    anchor.style.display = 'none'
    document.body.appendChild(anchor)
  }
  anchor.setAttribute('href', url)
  anchor.click()
  URL.revokeObjectURL(url)
})
const main = document.getElementById('main')
main.addEventListener('scroll', () => {
  app.ports.onMainScrolled.send({clientX: main.scrollLeft, clientY: main.scrollTop})
})
</script>
</body>
</html>
